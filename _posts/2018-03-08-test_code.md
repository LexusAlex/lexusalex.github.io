---
layout: post
title:  Тестирование кода
date:   2018-03-08
author: Алексей Шмелев
categories: development
comments: true
cover:  "/assets/test/test.jpg"
---

В первой заметке про тестирование кода хочу просто объяснить что это такое и зачем это нужно.

Допустим начинаем проект "Калькулятор", написали выкатили в прод, пусть это будет большой калькулятор, состоящий из нескольких тысяч строк кода.
К нам начинают сыпаться баги, сразу же их фиксим и назад в прод, поправили, работает. 
Это сейчас хорошо мы помним что и где было исправлено, а через год, вы легко сможете воспроизвести баг? скорее всего нет.
Нужна некая сетка безопасности, страховка что все работает. Такой сеткой являются Автоматические тесты или как их еще называют Юнит тесты.

Реализуем наш "Калькулятор"

Например простейший псевдокод:

~~~text

class Calculator {

    function plus(a,b){
        return a + b;    
    }
}
~~~

тест к нему

~~~text

class TestCalculator {
    
    function testAddition(){
    
        calc = new Calculator();
        
        assertEquals(calc.plus(3,4), 7);
        
    }
}
~~~
Теперь просто запустив этот тест, мы точно будем уверены за наш код, в данном случае тест пройдет.

Предположим , что нужно внести правки

~~~text

class Calculator {

    function plus(a,b){
        return (a + b) * 2;    
    }
}
~~~
Запускаем тесты, они сломаются, то есть мы сразу видим что и где поломалось (тест testAddition), а теперь представьте в проекте сотни классов, и тысячи тестов, запустив проверку одной командой, сразу увидим что сломалось.

Отмечу причины почему люди не пишут тесты:

- Нет времени на них, бизнес не будет ждать пока ты будешь писать тесты
- Нет денег на написание, дорого (это доп расходы, затраты)
- Команда никогда не писала тестов
- Нет смысла писать тесты, если никаму это не нужно

Есть такой подход когда сначала пишут тесты, а потом уже код - это меняет мышление, потому что нет реализации.

Например, нужно проверить проходит ли авторизация и залогинен ли пользователь, как обычно это делаем, вводим тестовые данные, логин, пароль и понеслась - это называется "ручное тестирование".
Здесь идея в другом, мы должны написать, как бы мы тестировали код без самого кода, звучит не очень, но тем не менее.

Проеряем, что у нас есть такой пользователь и он успешно прошел авторизацию на сайте.
~~~text

class TestAuth {
    
    function testLogin(){
    
        user = new User(Вася, 123);      
        assertTrue(user->isUser());
        
        login = new Login(user);       
        assertTrue(login->start());            
    }
}
~~~

Так, как у нас еще нет классов User, Login , тест провалится. Сложно но можно. Потом пишем уже реализацию, доводим до того , чтобы тест прошел. Думаю идея понятна

Я слышал о другом подходе, который на мой взгляд лучше подходит. 
Сначала пишем только код, ничего не тестируя, далее выкладываем его на тестовый или продакшен сервер, потом пользователи (лучше они) или мы сами начинаем активно ломать код, приходит от них баг, пишем тест на него, снова деплоем, цикл повторятся, получается создание тестов в ответ на баги.
И чем больше багов будет приходить, тем лучше.


Резюмируя, что написал выше

1. Пишем много кода (совершенно ничего не зная о тестах)
1. Деплой
1. Активная эксплуатация (тестирование)
1. Репорт багов (письмо, заказчик прислал и пр.)
1. Пишем тест под баг (если сети безопасности нет, то нужно ее создать)
1. Фиксим код
1. к п. 2

При таком подходе поначалу будем писать много тестов, и немного вносить правки в код продукта. С течением времени сеть стабилизируется.

Задача тестов, дать нам правильные сигналы, багов всегда мало, к тому же воспроизвести баг довольно сложная задача.

Итак тесты нам дают:
1. Уверенность за свой код
1. Разработка без страха
1. Поддержка без боли для других

В следующих заметках продолжим говорить о тесировании, рассмотрим виды тестов

