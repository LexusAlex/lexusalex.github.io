---
layout: post
title:  Linux - права доступа к файлам и папкам
date:   2018-02-03
author: Алексей Шмелев
categories: linux
comments: true
cover:  "/assets/linux/l.png"
---

Поговорим про права доступа в linux.

Каждый объект в linux имеет свой идентификатор

- Пользователь UID
- Группа GID
- Фаил Inode

Чтобы просматривать каталоги используется команда ls, наверное самая известная в linux. У этой команды множество ключей

Чтобы посмотреть расширенный список с характеристиками объектов c inode файла используем команду ls -li

~~~bash
ls -li

6698807 -rw-rw-r-- 1 alex alex    0 янв 28 16:25 analytics.html

6698807 - inode файла
-rw-rw-r-- - права доступа и тип файла
1 - колличесво жестких ссылок на фаил то есть счетчик ссылок на фаил
alex - имя владельца файла
alex - имя группы владельца файла
0 - размер файла в байтах
янв 28 16:25 - дата создания файла
analytics.html  - название

~~~


### Типы объектов 

В команде ls это первый символ (-) в правах доступа -rw-rw-r--

- Фаил просто последовательность байтов, здесь не важно расширение

- d Каталог - 

В каталоге если две ссылки . - сам каталог, .. - Его родительский каталог
На фаил могут вести сразу несколько ссылок одновременно.
Файловая система подсчитывает количество ссылок на фаил. 
Просто файловая система позволяет создавать несколько ссылок на один объект

- с Символьное устройство

- b Блочное устройство

- s Локальный сокет

- P - Именованный канал

- l - Символическая ссылка - псевдоним на фаил

### Права доступа

Доступ к объекту состоит из групп букв:

- r - чтение
- w - запись
- x - выполнение

Группы для кого устанавливать права:

- владелец
- группа
- все остальные

получается так (rwx rwx rwx)

Так же все тоже самое можно представить в виде чисел:

- r = 4
- w = 2
- x = 1
- - = 0

числа суммируются и получается итоговое число, получаем всевозможные разрешения

- 421 = 7 - чтение запись и выполнение
- 420 = 6 - чтение и запись
- 401 = 5 - чтение и выполнение
- 400 = 4 - чтение
- 021 = 3 - выполнение и запись
- 020 = 2 - запись
- 001 = 1 - выполнение
- 000 = 0 - ничего не разрешено

Получается что каждому файлу соответствует набор из 9 битов режима.
Также существуют еще 3 бита, которые влияют на работу исполняемых файлов.
Изменять права доступа может или владелец, или суперпользователь.

Дополнительные атрибуты файлов, используются не часто
- sticky bit - 1000 или 1 (обозначается буквой t) - защита от удаления файлов, из такой директории пользователь может удалить только файлы, владельцем которых он является 
- setuid - 4000 - 4 (s) - устанавливается на исполняемый фаил, независимо от того кто запускает фаил, он запускается с правами владельца файла
- setgit - 2000 - 2 (s)- тоже самое только распространяется на группу

Есть такой нюанс, так как этот бит перекрывает стандартные биты доступа, в примере выше, если t маленькое то x установлен, если T большое то бит не установлен.
Как пример директория /tmp/ посмотрим ее атрибуты

~~~bash
ls -ld /tmp/

drwxrwxrwt 13 root root 12288 фев  3 21:14 /tmp/
~~~
### Изменение прав доступа

Права на фаил может изменить его владелец или суперпользователь

Пример имеем фаил index.php, его владельцем является пользователь alex, следовательно менять его права может сам владелец или суперпользователь

~~~bash
ls -ld index.php 
-rw-rw-r-- 1 alex alex 496 янв 27 13:12 index.php

~~~

Для изменения прав использутеся команда chmod

~~~bash
chomod [группа прав ugoa][действия -+=][какие права rwxXst или [0-7]+][объект для которого нужно изменить права]

[ugoa]*([-+=]([rwxXst]*|[ugo]))+|[-+=][0-7]+

~~~

Например запретим любые действия с файлом всем

~~~bash
chmod 000 index.php
----------
~~~

Разрешить всем группам читать фаил

~~~bash
chmod 444 index.php
-r--r--r--
~~~

Добавим всем группам право на чтение

~~~bash
chmod a+w index.php
-rw-rw-rw-
~~~

Можно даже делать такие штуки, уберем право на запуск у пользователя, добавим право на запуск группе, уберем права на чтение и запись у всех остальных
~~~bash
chmod u-r,g+x,o-rw index.php
--w-rwx---
~~~

Убрать все у всех, получим вариант из первого примера


````bash
chmod ugo-rwx index.php
----------
````

У команды chmod есть полезные ключи, как -v , показать подробную информацию о вносимых изменениях

~~~bash
chmod ugo+rwx -v index.php
права доступа 'index.php' изменены с 0010 (-----x---) на 0777 (rwxrwxrwx)
~~~

Если нужно присвоить права всем файлам в каталоге рекурсивно добавляем флаг -R

Далее мы продолжим рассматривать важные темы в linux