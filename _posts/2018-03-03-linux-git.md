---
layout: post
title:  Работа с Git
date:   2018-01-30
author: Алексей Шмелев
categories: about
comments: true
cover:  "/assets/hello/hello.jpg"
---

Так уж вышло с система котроля версий git стала стандартом и используется повсеместно при разработке и для хранения исходного кода

Git работает во всех распростаненных операционных системах, на оф. сайте подробно описаны способы установки
[установка git в linux](https://git-scm.com/download/linux)

После установки проверяем версию

~~~bash
git --version

git version 2.16.2
~~~

Если у вас уже был установлен git, то обновиться до последней версии в моем случае в ubuntu можно так

~~~bash
sudo add-apt-repository ppa:git-core/ppa
sudo apt update
sudo apt install git
~~~

Посмотрим какие стандартные команды есть в гите

~~~bash
git

Стандартные команды Git используемые в различных ситуациях:

создание рабочей области (смотрите также: git help tutorial)
   clone      Клонирование репозитория в новый каталог
   init       Создание пустого репозитория Git или переинициализация существующего

работа с текущими изменениями (смотрите также: git help everyday)
   add        Добавление содержимого файла в индекс
   mv         Перемещение или переименование файла, каталога или символьной ссылки
   reset      Сброс текущего состояния HEAD на указанное состояние
   rm         Удаление файлов из рабочего каталога и индекса

просмотр истории и текущего состояния (смотрите также: git help revisions)
   bisect     Выполнить двоичный поиск изменения, которое вносит ошибку
   grep       Вывод строк, соответствующих шаблону
   log        Вывод истории коммитов
   show       Вывод различных типов объектов
   status     Вывод состояния рабочего каталога

выращивание, отметка и настройка вашей общей истории
   branch     Вывод списка веток,  их создание или удаление
   checkout   Переключение веток или восстановление файлов в рабочем каталоге
   commit     Запись изменений в репозиторий
   diff       Вывод разницы между коммитами, коммитом и рабочим каталогом и т.д.
   merge      Объединение одной или нескольких историй разработки вместе
   rebase     Повторно применить коммиты над верхушкой другой ветки
   tag        Создание метки, вывод списка, удаление или проверка метки, подписанной с помощью GPG

совместная работа (смотрите также: git help workflows)
   fetch      Загрузка объектов и ссылок из другого репозитория
   pull       Извлечение изменений и объединение с другим репозиторием или локальной веткой
   push       Обновление внешних ссылок и связанных объектов

~~~

## Настройки

Первым делом нужно настроить гит, здесь можно настроить гит глобально для всех пользователей, для конктретного пользователя и для определенного репозитория, или использоватет свой фаил 

посмотрим на опции размещения файла конфигурации утилиты git config

~~~bash
git config

Размещение файла конфигурации
    --global              использовать глобальный файл конфигурации
    --system              использовать системный файл конфигурации
    --local               использовать файл конфигурации репозитория
    -f, --file <файл>     использовать указанный файл конфигурации
    --blob <идент-двоичн-объекта> прочитать настройки из указанного двоичного объекта

~~~

Теперь нужно установить email и имя пользователя для отображения в коммитах, к примеру сделаем для всех репозиторием текущего пользователя

~~~bash
git config --global user.name "alex"
git config --global user.email "alexsey_89@bk.ru"
~~~

настройки для текущего пользователя хранятся в файле  ~/.gitconfig, системные настройки для всех пользователей /etc/gitconfig, локальные настройки хранятся в самом репозитории, но об это чуть позже

проверить настройки можно командой git config -l или открыть фаил вручную.

### Создание репозитория

Чтобы создать новый репозиторий нужно в текущей папке с проектом выполнить ``git init`` , чтобы создать в другой папке, указваем явно `git init folder-name`

~~~bash
git init

Инициализирован пустой репозиторий Git в /home/alex/projects/sicp/.git/

~~~

При этом создалась скрытая папка ./git по сути это и есть репозиторий, теперь в файле .git/config содержаться параметры репозитория, в моем случае такие

~~~bash
cat .git/config

[core]
	repositoryformatversion = 0
	filemode = true
	bare = false
	logallrefupdates = true
~~~

### Просмотр состояния репозитория

Очень важная команда это `git status` просмотр текущего состояния репозитория, в данном случае у меня есть два файла в рабочем каталоге /sicp где я создал пустой репозиторий

~~~bash
git status
На ветке master
Еще нет коммитов

Неотслеживаемые файлы:
  (используйте «git add <файл>…», чтобы добавить в то, что будет включено в коммит)

	.gitignore
	README.md

ничего не добавлено в коммит, но есть неотслеживаемые файлы (используйте «git add», чтобы отслеживать их)

~~~

Сейчас гит никак не отслеживает изменения этих файлов, как пишут в подсказке, нужно добавить файлы в отслеживаемые

### Добавление/Удаление файлов из отслеживаемых

Команда `git add` добавляет фаил или папку в отслеживаемые гитом

~~~bash
git add .gitignore

На ветке master
Еще нет коммитов

Изменения, которые будут включены в коммит:
  (используйте «git rm --cached <файл>…», чтобы убрать из индекса)

	новый файл:    .gitignore

Неотслеживаемые файлы:
  (используйте «git add <файл>…», чтобы добавить в то, что будет включено в коммит)

	README.md

~~~

Примеры

~~~bash
git add .gitignore text.txt # добавить существующие файлы или папки
git add . # добавить в отслеживаемые все файлы в папках и подпапках
git add -i # интераткивное добавление файлов
git add -p # поочередный просмотр файлов
~~~

Как правило git add с указанием папок или файлов хватает за глаза, об остальных ключах можно прочитать в доументации

Обратная операция, убрать из отслеживания команда ``git rm``

Примеры

~~~bash

git rm --cached readme.txt text.txt # удалить файл из отслеживаемых
git rm --cached -r folder # удалить папку из отслеживаемых

~~~

### Состояния файлов

- untracked - Не отслеживаемый фаил
- tracked - Отслежиеваемые фаилы, у этих файлов есть подтипы
    + unmodified - это не измененный файл в рабочей директории и в репозитории
    + modified - это измененный unmodified файл
    + staged - это файлы готовые к коммиту, то что делает команда git add
    
Давай-те к примерам. С неотслежиеваемыми файлами все понятно, на них гит никак не реагирует, они отображатся так

~~~bash

Неотслеживаемые файлы:
  (используйте «git add <файл>…», чтобы добавить в то, что будет включено в коммит)

	README.md

~~~

Те файлы которые отслеживает гит, unmodified, их никак не отображает команда git status, это файл с которым мы ничего не делали в рабочей директории, но который закомичен.
Я уже сделал первый коммит, закомитив фаил .gitignore

~~~bash
git commit -m "add gitignore"
[master (корневой коммит) 4c0dc45] add gitignore
 1 file changed, 7 insertions(+)
 create mode 100644 .gitignore
~~~

В даном случае unmodified фаил это .gitignore, теперь изменим этот фаил, получим состояние modified, то есть измененный

~~~bash
На ветке master
Изменения, которые не в индексе для коммита:
  (используйте «git add <файл>…», чтобы добавить файл в индекс)
  (используйте «git checkout -- <файл>…», чтобы отменить изменения
   в рабочем каталоге)

	изменено:      .gitignore

Неотслеживаемые файлы:
  (используйте «git add <файл>…», чтобы добавить в то, что будет включено в коммит)

	README.md

~~~

Снова как написано в подсказке, добавим фаил, то есть подготовим фаил к коммиту, получим состояние staged, теперь эти изменения можно комитить.
Далее изменим снова фаил

~~~bash
git add .gitignore

vim .gitignore 

git status

На ветке master
Изменения, которые будут включены в коммит:
  (используйте «git reset HEAD <файл>…», чтобы убрать из индекса)

	изменено:      .gitignore

Изменения, которые не в индексе для коммита:
  (используйте «git add <файл>…», чтобы добавить файл в индекс)
  (используйте «git checkout -- <файл>…», чтобы отменить изменения
   в рабочем каталоге)

	изменено:      .gitignore

Неотслеживаемые файлы:
  (используйте «git add <файл>…», чтобы добавить в то, что будет включено в коммит)

	README.md

~~~

Видим что файл сейчас находится в двух состояниях staged и modified, если прямо сейчас сделать git commit, то изменения которые в индексе будут включены в коммит

### Удаление файлов из индекса

Команда ``git reset`` переводит фаил в состояние modified, то есть убираем его из подготовленных к коммиту, допустим в нашем случае, мы забыли что-то добавить в фаил .gitignore

~~~bash
git reset .gitignore
Непроиндексированные изменения после сброса:
M	.gitignore

~~~

В данном случае в файле останутся изменения которые были в двух состояниях

### Вернуть фаил в состояние репозитория

Команда ``git checkout`` совершает сброс к последнему закомиченному варианту файла, то есть удаляет все ваши изменения из рабочей копии

~~~bash
git checkout .gitignore
~~~

Так же этой командой можно бегать по истории коммитов, указав его хеш

~~~bash
git checkout b9533bb
~~~


 
### Ветки

