---
layout: post
title:  Linux. Планировщик cron
date:   2018-03-17
author: Алексей Шмелев
categories: linux
comments: true
cover:  "/assets/linux/cron.jpg"
---

CRON - это стандартная утилита для запуска периодически выполняемых команд. 
На самом деле планировщик - это серьезный инструмент системного администратора, для выполнения периодических задач
Пользовательские файлы конфигурации хранятся в каталоге:

~~~bash
/var/spool/cron/crontabs/
~~~
Для каждого пользователя можно создать только один такой фаил. Демон cron выполняет свою работу молча, но так же может вести лог.
Задача крона выполнять нужные процессы в нужное время.

## Формат файлов

Важно понимать и разбираться в синтаксисе:

~~~bash
минута час день месяц день_недели (пользователь для системных задач)команда
0-59   0-23 1-31 1-12     0-6     /bin/bash

любое значение в шаблоне можно заменить на * , что значит любой сисмвол
7-10 - диапазон значений
минимальное время выполнения 1 минута
0 - воскресенье

45 10 * * 1-6
~~~

 посмотрим на примерах

~~~bash
* * * * * /bin/bash выполнять скрипт каждую минуту
10 * * * * /bin/bash каждый час в десятую минуту
* */2 * * * /bin/bash каждый четный час
10 16 * * * /bin/bash в 16.10 каждый день
0 0 * * * /bin/bash каждый день в полночь
10 16 20 * * /bin/bash в 16.10 20 числа каждого месяца
10 16 20 12 * /bin/bash в 16.10 20 декабря
0 0 1 1 * /bin/bash один раз в год 1 января в 0.00 мин
05 16 1 1 1 /bin/bash в 16.05 1 января если этот день понедельник
10 16 * * 6 /bin/bash в восресенье 10.16 любого месяца
0-59 18 * *  /bin/bash каждую минуту в 18 часов - диапазон
0 22 * * 1-5 /bin/bash по рабочим дням в 22.00
5,10,15 0-23 * * 6 /bin/bash на 5,10,15 минуте каждого часа в восресенье
*/15 16 * * * /bin/bash каждые 15 минут в 16 часов
~~~

### Конфигурация

Фаил конфигурации для системных задач крона в ubuntu лежит здесь ``/etc/crontab``

~~~bash
# /etc/crontab: system-wide crontab
# Unlike any other crontab you don't have to run the `crontab'
# command to install the new version when you edit this file
# and files in /etc/cron.d. These files also have username fields,
# that none of the other crontabs do.

SHELL=/bin/sh
PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin

# m h dom mon dow user  command
17 *    * * *   root    cd / && run-parts --report /etc/cron.hourly
25 6    * * *   root    test -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.daily )
47 6    * * 7   root    test -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.weekly )
52 6    1 * *   root    test -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.monthly )
# 

~~~

Здесь содержатся команды на выполнение скриптов ежечасно, ежедневно, еженедельно, ежемесячно, можно закинуть в эти директории скрипты и они будут выполнятся

Команда crontab

1. crontab -l - задачи для текущего пользователя
1. crontab -r - удалить текущий фаил расписания
1. crontab -e - создать задачи для текущего пользователя

Созданием файлов cron.deny и cron.allow можно разрешить или запретить с указанием пользователя доступ к задачам для пользователя.

Крон крайне полезная штука для автоматизации процессов, рекомендую к применению.