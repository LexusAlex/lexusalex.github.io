--- 
layout: post 
title: Создание образа. part 1
permalink: docker-create-image
tags: docker linux  docker
comments: true
---

Образ создается на основе `Dockerfile` и контекста. Контекст - это файлы находящийся в заданном месте.

Для создания образа используеться команда `docker build` с ключами:

~~~bash
--file, -f # путь до Dockerfile, по умолчению ./
--tag, -t # имя образа
--no-cache # запретить кеширование образов

~~~

И `Dockerfile`, в котором указаны инструкции для выполнения.

В качестве примера возмем образ [busybox](https://hub.docker.com/_/busybox), посмотрим из чего состоит его `Dockerfile`

~~~bash
FROM scratch
ADD busybox.tar.xz /
CMD ["sh"]
~~~

Первой инструкцией всегда должна идти инструкция `FROM`, в которой указывается базовый образ. Далее нужно создать файловую
систему образа, воспользуемся командой `ADD` которая рекурсивно скопирует файлы из контекста в создаваемый образ, в данном
случае будет распакован архив. Последняя команда `CMD` запустит указанную инструкцию во время создания контейнера.

Скачаем образ командой `docker pull busybox`, в данном случае можно обойтись и без сборки образа, так все что нужно уже
находиться в родительском образе, но мы соберем собственный образ укажем только одну команду `FROM busybox`

~~~bash
docker build -t test .
~~~

где укажем название и контекст ,текущая директория запуска этой команды

~~~bash
docker build -t test .
Sending build context to Docker daemon  3.072kB #1
Step 1/1 : FROM busybox #2
latest: Pulling from library/busybox #3 
b4a6e23922dd: Pull complete #4
Digest: sha256:8ccbac733d19c0dd4d70b4f0c1e12245b5fa3ad24758a11035ee505c629c0796 #4
Status: Downloaded newer image for busybox:latest #5
 ---> 758ec7f3a1ee #6
Successfully built 758ec7f3a1ee #7
Successfully tagged test:latest #8
~~~

Разберем вывод команды построчно

Я создал файл hello в качестве контекста. Первое что делает процесс сборки - это оправляет весь контекст в демон (#1).
В данном случаее это мой фаил hello. Далее начиначет читать инструкции из `Dockerfile` (#2). Проверяем если данного образа
нет на локальной машине то он будет скачан (#3 ,#4, #5, #6, #7). 
Так как мы создавали новый образ на основе busybox, но в `Dockerfile` была только одна команда, будет создан полностью
одинковый образ с родительским (#8).

Для проверки будем создавать новый контейнер на основе наших образов командой `docker run --name myconteiner -it --rm test`, 
запускать его, попадать в оболочку и по выходу койнейнер будет удален.

На что следует обратить внимание при создании образа:
1. Необходимо обязательно передавать контекст в команду `docker buil`
2. Каждая инструкция в `Dockerfile` создает новый слой (уровень), который кэшируется и при успешном созданий может быть
переиспользован при пересборке образа
3. Не обязательно всегда создавать образ с нуля, можно воспользоваться уже готовыми образами поискав в [реестре образов](https://hub.docker.com/)
4. Для получения новой версии образа необходимо явно выполнять команду `docker pull`

### Dockerfile

До этого мы рассмотрели лишь некоторые команды из `Dockerfile`, рассмотрим другие инструкции:

1. `FROM` - определяет основной образ на основании которого будет создан текущий, эта инструкция должна быть первой
   `FROM ubuntu:latest`
2.    









   


 



 