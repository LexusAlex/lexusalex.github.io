---
layout: post 
title: Установка UNIX
permalink: unix-install
tags: unix linux
--- 

Разобрать все по статьям с бодее детальным описанием

Инсталятор - это программа для установки операционной системы

Бывают два режима инсталяции:
1. Интерактивный режим - установка одной ОС
2. Пакетный режим - установка N ОС


Определяем источник инталяции CD, HDD, NFS, FTP, HTTP


Опции инсталяции - Как инсталяировать
Куда инсталировать - Разбиение диска

Диски разбиваются на разделы, в разделе создается ФС
Цель создать дерево каталогов

Что инсталировать Инсталяция пакетов . Драйвера входят в пакеты
Пакет, Группа пакетов, Кластер
Репозиторий - дерево зависимостей пакетов

Основная единица ПО - это пакет

Процесс копирования пакетов

Далее может начаться Постинсталиционное конфигурирование

Перезагрузка

Далее ОС начнется загружаться из того дерева каталгов куда ее инсталировали

-------------------

Управление ПО

Пакет php.deb - это архив . Пакеты находятся в репозитории, список зависимостей между пакетами, инструкции по
инсталяции, инструкции по деинсталяции

Пакет - это функциональная единица

Менеджер пакетов - инсталяции / деинсталяция пакетов
Red Hat - rpm
Debian - dpkg - debian package manager

Менеджеры зависимостей - работает с зависимостей
Red Had Cent Os - yum yellow dog update manager
Debian - apt-get auto package tool

Одна программа решает одну задачу

dpkg -l

Название версия релиз архитектура
liburl-dispatcher1:amd6 0.1+16.04.201511 amd64

Список файлов пакета
dpkg -L wget

ii - установлен и файлы и документация
rc - удален но осталвены конфигурационные файлы

Инсталяция - это не только распаковка и установка но еще и его настройка

Нельзя просто так взять и удалить пакет - вот для этого существуют менеджеры зависимотей

Репозиторий список пакетов с зависимостями между ними

-------------------

Конфигурационные файлы

Конфигурационные файлы пример /etc/passwd

Декларативные
Таблица с разделителями field1:field2:fieldn выбран один символ для разделения в конце должен стоять символ перевода строки
Простая таблица field1 field2 fieldn (TAB, space) - сколько угодно пробелов символ для разделения в конце должен стоять символ перевода строки

Каждый конфигурационный файил имеет справку

Импреативные
Командный файл shell, программа которая выполняется

Var1 = val1
Var2 = val2

Находятся в каталог /etc/ документация может быть в свободном текстовом формате
Всегда можно узнать к какому пакету принадлежит фаил


Документация
Manual pages /usr/share/man 8 секций документации
Info pages /usr/share/info
Documentation /usr/share/doc

-----------
Полномочия

sudo - передача полномочий
/etc/sudoers - конфигарационный фаил кому разрешено передавать полномочия
/etc/sudo.d/*

программа visudo - идет проверка синтаксиса файла
# - это комментарий

u      h u     cmd
root ALL=(ALL) ALL

Суперпользователю на любых узлах от любых третьих лиц можно запускать все что угодно

Настройка прав

http://rus-linux.net/kos.php?name=/papers/boot/index.html#pred

---------------------

Пользовательские учетные записи

Бывают реальные пользователи и пользователи служб

USER

/etc/passwd - Публичная таблица
/etc/shadow - Приватная таблица

username - имя пользователя без пробелов, цифры и буквы тоже самое в двух таблицах
password - пароль - x - отсуствует в публичной таблице, в закрытой хранится его хеш
UID - id пользователя
GID - id Группы пользователя
GCOS - комментарий
home-dir - домашний каталог
shell - командный интерпретатор

lastchange дни с 1.01.1970 до момента когда пользователь последний разменял пароль - 17334
min - минимальный возраст пароля - 0
max - максимальное кол-во дней через сколько точка когда пользователь должен сменить пароль - 99999
warn - дней сколько пользователя предупреждают через сколько нужно сменить пароль - 7
inactive - дней до деактивации учетной записи, до принудительного отключения
expire - возраст учетной записи целиом, от 1.01.1970 промежуток действия целиком дд

Чтобы отключить поле мнужно поставить пустоту
username:password:UID:GID:GCOS:home-dir:shell
username:password:lastchange:min:max:warn:inactive:expire
              
root:x:0:0:root:/root:/bin/bash

В открытой части не хранятся пароли
Пароли ранятся в закрытом файле в хешированном виде, но только у живых пользователей, у всех остальных
там стоит * или !! или ! - это сделано для того чтобы нельзя войти под этими пользователями


passwd -l student - заблокировать учетную запись
passwd -u student - разблокировать учетную запись

GROUP

В случае с группами все тоже самое 

/etc/group - Публичная таблица групп
/etc/gshadow - Приватная таблица групп

Когда то существовал пароль группы
Список членов группы существует динамически

Появились администраторы группы, которые могут изменять список членов группы

groupname:password:GID:mem,mem,mem,mem
groupname:password:admin,admin...:mem,mem,mem,mem


id alex - узнать id пользователя
groups alex - список групп
finger alex - доп инфо
chage -l alex

Так же существуют конфигурационные файлы для них

useradd - создать пользователя

Файлы пользователя пользовательского профиля

Общисистемный профиль /etc - 1
Профиль по умолчанию /ect/skel
Профиль пользователя $Home home dir - 2


------------------------
Загрузка операционной системы

1. POST ROM BIOS
Power On Self Test
Del F12 запустить программу SETUP, которая берется из микросхемы BIOS
2. ROM LOADER ROM BIOS
3. Согласно ROM BIOS NVRAM
Энергонезависимая память, загрузка HD
4. MBR - Master boot record LOADER Zero boot stage boot manager
С диска считывается MBR

первые 512 байт диска там загрузчик, там же таблица разделов
В каждом из разделов диска находятся PBR загрузочные записи самих разделов

MBR PBR PBR PBR - в каждый из разделов может быть устанвлена ОС
    P1  P2   P3
5. PBR LOADER boot record (active partition) first boot stage
Определеляется загрузочный раздел
6. OS LOADER active partion second boot stage
Загрузчик для ОС - принимает параметры загрузки ядра
7. Kernel OS Partion
Происходит загрузка Ядра
8. ROOT FS /sbin/init
Монтируется корневая файловая система

initramfs initrd - совокупность модулей ядра
только те которые нужны для монтирования файловой системы
FS driver
DISK driver
CONTROLLER driver
BUS driver
Фаиловая система находися на разделе диске


/sbin/init PID 1 - первый процесс

Ядро ОС - это простая программа
Ядро это 
vmlinuz - остов ядра - драйвера модули ядра *.ko - это и есть ядро
initrm - начальный фаил

параметры ядра

----
Процедура запуска\останова системных служб

Стили запуска
SystemV
Systemd
BSD
Upstart

1. Получает управление процесс /sbin/init PID=1
2. Считываение конфигурационного файла /etc/inittab
3. Запуск основного сценария системной инициализации /etc/rc.sysinit + монтирование всех остальных файловых систем
4. Запуск основного сценария запуска системных служб

S - однопользовательский режим
Run level Уровни запуска
0 - Halt
1 - Single User Mode
2 - Multi User Mode без поддежки сети
3 - Multi User Mode с поддежкой сети
4 - Multi User GUI Mode c графической подсистемной
5 - ------\------\------
6 - Reboot

Числа берутстся из конфига

RC - run control - упраление ходом системной инициализации

5. /etc/rc<ID>.d/K* stop останов сценариев с ключевого слова K
6. /etc/rc<ID>.d/S* start запуск сценариев с ключевого слова S

Одни службы нужно запустить другие нужно остановить

/etc/syscongfig/<conf>

7. Запуск служб , если что то пойдет не так то будет запущена напрямую /sbin/mingetty /bin/login <shell>


Сами сценарии в /etc/init.d

service httpd stop опции службы 

chkconfig  утилита для просмотра какие службы запущены

Состояния

Poweroff - самое стабильное состояние 
ON
LOADER
runlevel s однопользовательский режим
runlevel 2 3 4 5 многопользовательский режим
shutdown runlevel 1 -> runlevel s
poweroff -> runlevel 0 выключает питание автоматически
halt 
reboot runlevel 6

Утилиты
/sbin/init - /etc/initctl 

shutdown - отсложенный останов
halt
reboot
poweroff
runlevel


Вход пользователя

/sbin/init


----

загрузчик ОС

0 1 2 Stage этапы загрузки

LILO

MBR stage 0
PBR stage 1
OS partition stage 2


/sbin/lilo - инсталятор загрузчика
/etc/lilo.conf
/boot/map

Строит карту загрузки, рабоатет с номерами блоков


GRUB - не имеет к линуксу никакого отношения

MBR stage 0
PBR stage 1
OS partition stage 2

/boot/grub/ stage 1 512b
/boot/grub/ stage 2 ~100kb неизвесно где помещется
/boot/grub/<fs> stage 2 ~100kb неизвесно где помещется

Взаимеодействуем со вторым шагом

/sbin/grub - инсталятор загрузчика
/boot/grub/menu.lst

На этапе загрузке можно сообщить загрузчику

Если повреждено ядро ОС, нужно иметь загрузочный носитель
на котором есть то что разрушено

Например флешка, CD, сеть

Rescue installed system 

Никогда не нужно заморачиваться, windows так windows

Можно вручную сделать загрузочную флешку

SYSLINUX - CD PXE HD